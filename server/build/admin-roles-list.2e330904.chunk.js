"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[3455],{98906:(X,O,o)=>{o.r(O),o.d(O,{default:()=>G});var e=o(67294),r=o(95489),A=o(87751),C=o(41363),t=o(28702),B=o(96486),S=o(63852),M=o(97132),N=o(49656),F=o(48474);const W=()=>"todo empty role";var j=o(45697),f=o.n(j);const x=({id:l,name:d,description:n,usersCount:u,icons:m,rowIndex:i})=>{const{formatMessage:E}=(0,M.useIntl)(),h=E({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:u});return e.createElement(t.Tr,{"aria-rowindex":i,key:l,...(0,r.onRowClick)({fn:m[1].onClick})},e.createElement(t.Td,{maxWidth:(0,r.pxToRem)(130)},e.createElement(t.Typography,{ellipsis:!0,textColor:"neutral800"},d)),e.createElement(t.Td,{maxWidth:(0,r.pxToRem)(250)},e.createElement(t.Typography,{ellipsis:!0,textColor:"neutral800"},n)),e.createElement(t.Td,null,e.createElement(t.Typography,{textColor:"neutral800"},h)),e.createElement(t.Td,null,e.createElement(t.Flex,{justifyContent:"flex-end",...r.stopPropagation},m.map((a,p)=>a?e.createElement(t.Box,{key:a.label,paddingLeft:p===0?0:1},e.createElement(t.IconButton,{onClick:a.onClick,label:a.label,noBorder:!0,icon:a.icon})):null))))};x.propTypes={id:f().number.isRequired,name:f().string.isRequired,description:f().string.isRequired,usersCount:f().number.isRequired,icons:f().array.isRequired,rowIndex:f().number.isRequired};const U=x;var V=o(18172);const H={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},Z=(l,d)=>(0,V.default)(l,n=>{switch(d.type){case"ON_REMOVE_ROLES":{n.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{n.shouldRefetchData=!0,n.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{n.shouldRefetchData=!1,n.roleToDelete=null,n.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{n.roleToDelete=d.id;break}default:return n}}),Q=()=>{(0,r.useFocusWhenNavigate)();const{isLoading:l,allowedActions:{canCreate:d,canDelete:n,canRead:u,canUpdate:m}}=(0,r.useRBAC)(A.Z.settings.roles),{getData:i,roles:E,isLoading:h}=(0,F.bF)(!1),[{query:a}]=(0,r.useQueryParams)(),p=a?._q||"",R=(0,S.ZP)(E,p,{keys:["name","description"]});return(0,e.useEffect)(()=>{!l&&u&&i()},[l,u,i]),{isLoadingForPermissions:l,canCreate:d,canDelete:n,canRead:u,canUpdate:m,isLoading:h,getData:i,sortedRoles:R,roles:E}},$=({getData:l,canCreate:d,canDelete:n,canUpdate:u})=>{const{formatMessage:m}=(0,M.useIntl)(),i=(0,r.useNotification)(),[E,h]=(0,e.useState)(!1),{push:a}=(0,N.useHistory)(),[{selectedRoles:p,showModalConfirmButtonLoading:R,roleToDelete:P},T]=(0,e.useReducer)(Z,H),{post:b}=(0,r.getFetchClient)(),v=async()=>{try{T({type:"ON_REMOVE_ROLES"}),await b("/admin/roles/batch-delete",{ids:[P]}),await l(),T({type:"RESET_DATA_TO_DELETE"})}catch(s){const c=(0,B.get)(s,["response","payload","data","ids"],null);if(c&&Array.isArray(c)){const K=c.join(`
`);i({type:"warning",message:K})}else i({type:"warning",message:{id:"notification.error"}})}g()},y=(0,e.useCallback)(s=>{a(`/settings/roles/duplicate/${s}`)},[a]),k=()=>a("/settings/roles/new"),D=(0,e.useCallback)(s=>{T({type:"SET_ROLE_TO_DELETE",id:s}),g()},[]),g=()=>h(s=>!s),L=(0,e.useCallback)(s=>{a(`/settings/roles/${s}`)},[a]),w=(0,e.useCallback)((s,c)=>{s.preventDefault(),s.stopPropagation(),c.usersCount?i({type:"info",message:{id:"Roles.ListPage.notification.delete-not-allowed"}}):D(c.id)},[i,D]),I=(0,e.useCallback)((s,c)=>{s.preventDefault(),s.stopPropagation(),y(c.id)},[y]),J=(0,e.useCallback)(s=>[...d?[{onClick:c=>I(c,s),label:m({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),icon:e.createElement(C.Duplicate,null)}]:[],...u?[{onClick:()=>L(s.id),label:m({id:"app.utils.edit",defaultMessage:"Edit"}),icon:e.createElement(C.Pencil,null)}]:[],...n?[{onClick:c=>w(c,s),label:m({id:"global.delete",defaultMessage:"Delete"}),icon:e.createElement(C.Trash,null)}]:[]],[m,w,I,L,d,u,n]);return{handleNewRoleClick:k,getIcons:J,selectedRoles:p,isWarningDeleteAllOpened:E,showModalConfirmButtonLoading:R,handleToggleModal:g,handleDeleteData:v}},z=()=>{const{formatMessage:l}=(0,M.useIntl)(),{isLoadingForPermissions:d,canCreate:n,canRead:u,canDelete:m,canUpdate:i,isLoading:E,getData:h,sortedRoles:a}=Q(),{handleNewRoleClick:p,getIcons:R,isWarningDeleteAllOpened:P,showModalConfirmButtonLoading:T,handleToggleModal:b,handleDeleteData:v}=$({getData:h,canCreate:n,canDelete:m,canUpdate:i}),y=a.length+1,k=6;if(d)return e.createElement(t.Main,null,e.createElement(r.LoadingIndicatorPage,null));const D=l({id:"global.roles",defaultMessage:"roles"});return e.createElement(t.Main,null,e.createElement(r.SettingsPageTitle,{name:"Roles"}),e.createElement(t.HeaderLayout,{primaryAction:n?e.createElement(t.Button,{onClick:p,startIcon:e.createElement(C.Plus,null),size:"S"},l({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null,title:D,subtitle:l({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),as:"h2"}),u&&e.createElement(t.ActionLayout,{startActions:e.createElement(r.SearchURLQuery,{label:l({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:D})})}),u&&e.createElement(t.ContentLayout,null,e.createElement(t.Table,{colCount:k,rowCount:y,footer:n?e.createElement(t.TFooter,{onClick:p,icon:e.createElement(C.Plus,null)},l({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null},e.createElement(t.Thead,null,e.createElement(t.Tr,{"aria-rowindex":1},e.createElement(t.Th,null,e.createElement(t.Typography,{variant:"sigma",textColor:"neutral600"},l({id:"global.name",defaultMessage:"Name"}))),e.createElement(t.Th,null,e.createElement(t.Typography,{variant:"sigma",textColor:"neutral600"},l({id:"global.description",defaultMessage:"Description"}))),e.createElement(t.Th,null,e.createElement(t.Typography,{variant:"sigma",textColor:"neutral600"},l({id:"global.users",defaultMessage:"Users"}))),e.createElement(t.Th,null,e.createElement(t.VisuallyHidden,null,l({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(t.Tbody,null,a?.map((g,L)=>e.createElement(U,{key:g.id,id:g.id,name:g.name,description:g.description,usersCount:g.usersCount,icons:R(g),rowIndex:L+2})))),!y&&!E&&e.createElement(W,null)),e.createElement(r.ConfirmDialog,{isOpen:P,onConfirm:v,isConfirmButtonLoading:T,onToggleDialog:b}))},G=()=>e.createElement(r.CheckPagePermissions,{permissions:A.Z.settings.roles.main},e.createElement(z,null))}}]);
